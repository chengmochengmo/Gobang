(()=>{var t={586:t=>{t.exports={port:31231,BACKGROUND_COLOR:"#F8E7B8",LINE_COLOR:"#C1A37B",PVPMap:{black:["黑"],white:["白"],otherColor:function(t){return"black"==t?"white":"black"},victoryOrDefeat:function(t,e){return t==e?"赢":"输"},victoryer:function(t){return t?"other":"my"}},CONNECTION:"connection",CONNECT:"connect",DISCONNECT:"disconnect",DISCONNECTING:"disconnecting",ERROR:"error",PLAYER_JOIN:"player.join",PLAYER_LEAVE:"player.leave",PLAYER_INFO:"player.info",PLAYER_READY:"player.ready",PLAYER_END:"player.end",PIECE_DOWN:"piece.down",PIECE_RECHESS:"piece.rechess",ROOMS_INFO:"rooms.info",MESSAGE:"message"}},321:t=>{t.exports="/images/d9d727fdf1514796ae6820598805eb5d.png"},295:t=>{t.exports="/images/4fcc85a9f1d35a66d2fefed854a85023.png"}},e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={exports:{}};return t[i](o,o.exports,n),o.exports}(()=>{"use strict";var t=n(586);const e=io.connect("http://localhost:".concat(t.port,"/"),{rememberUpgrade:!0,transports:["websocket"],secure:!0,rejectUnauthorized:!1});var i=void 0,o=void 0;function r(t,e,n){i||(i=document.createElement("div"),o=document.createElement("div"),a([i,o],["classList.add","classList.add"],["mask","toast"]),i.appendChild(o),document.body.appendChild(i)),console.log("toast内容：",t),a([o,i],["innerText","style.display"],[t,"flex"]);var r=setTimeout((function(){a(i,"style.display","none"),clearTimeout(r),r=null,n&&n()}),e||2500)}function a(t,e,n){if(!(Array.isArray(t)&&Array.isArray(e)&&Array.isArray(n))){if(!(t instanceof HTMLElement))throw new Error("domHandle args: dom not HTMLElement");for(var i=e.split("."),o="dom",r=0;r<i.length;r++)o+="['".concat(i[r],"']");return"function"==typeof new Function("dom","return ".concat(o))(t)?new Function("dom","".concat(o,"('").concat(n,"')"))(t):new Function("dom","".concat(o,"='").concat(n,"'"))(t)}if(t.length!==e.length||e.length!==n.length)throw new Error("domHandle args: length is difference");for(var s=0;s<t.length;s++)a(t[s],e[s],n[s])}function s(t,e){try{return t&&t.className===e?(console.log("相等",e),t):s(t.parentNode,e)}catch(t){return null}}var c=void 0,l=void 0,d={my:"",other:""},h=[],u=[],f=!1,m=localStorage.getItem("userName"),y=localStorage.getItem("userId");function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function p(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){o=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}return n}}(t,e)||g(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){if(t){if("string"==typeof t)return w(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(t,e):void 0}}function w(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function E(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var b=n(586);function C(t,e,n){return{X:Math.floor(t/n),Y:Math.floor((e-2*n)/n)}}const L=function(){function t(){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=checkerboard,this.context=this.canvas.getContext("2d"),this.lastTime=0,this.myLastDowningFill=null,this.otherLastDowningFill=null,this.lastPosition=[-1,-1],this.relastPosition=[-1,-1],this.clearLastPoint=!0,this.init(),this.eventInit(),e.on(b.PIECE_DOWN,(function(t){var e,i=p(t,2),o=i[0],r=i[1],a="[".concat(o,",").concat(r,"]");u.push(a),n.downPiece.apply(n,(e=t,function(t){if(Array.isArray(t))return w(t)}(e)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(e)||g(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).concat([d.other,!0])),f=!0,countDownRestart()}))}var n,i;return n=t,(i=[{key:"init",value:function(){this.context.width=this.context.height=this.canvas.width=this.canvas.height=this.canvas.offsetHeight,this.grid=15,this.spacing=this.context.width/(this.grid+1),this.pieceSize=this.spacing/2.5,this.lastPieceSize=2.3*this.pieceSize,this.context.fillStyle=b.BACKGROUND_COLOR,this.context.fillRect(0,0,this.context.width,this.context.height),this.context.lineWidth=2,this.context.strokeStyle=b.LINE_COLOR,this.context.strokeRect(1,1,this.context.width-2,this.context.height-2),this.context.lineWidth=1.5,this.context.strokeRect(4,4,this.context.width-8,this.context.height-8);for(var t=1;t<=this.grid+1;){var e=this.spacing*t;this.drawLine(e,0,e,this.context.width),this.drawLine(0,e,this.context.width,e),t++}var n={center:[8,8],topLeft:[3,3],topRight:[3,13],bottomLeft:[13,3],bottomRight:[13,13]};for(var i in n){var o=p(n[i],2),r=o[0],a=o[1];this.drawCircular(this.spacing*r,this.spacing*a,this.pieceSize/4,b.LINE_COLOR)}}},{key:"eventInit",value:function(){var t=this;this.canvas.addEventListener("touchstart",(function(e){if(f){var n=e.targetTouches[0],i=n.pageX,o=n.pageY,r=e.targetTouches[0].target.offsetTop;t.myLastDowningFill=t.setLastFill(),t.downingPiece(i,o-r)}}),!1),this.canvas.addEventListener("touchmove",(function(e){if(f){var n=(new Date).valueOf();if(!(n-100<=t.lastTime)){t.lastTime=n;var i=e.targetTouches[0],o=i.pageX,r=i.pageY,a=e.targetTouches[0].target.offsetTop;t.downingPiece(o,r-a)}}}),!1),this.canvas.addEventListener("touchend",(function(n){if(f){var i=n.changedTouches[0],o=i.pageX,a=i.pageY,s=n.changedTouches[0].target.offsetTop,c=C(o,a-s,t.spacing),m=c.X,y=c.Y;if(m<0||y<0||m>16||y>16)return t.context.drawImage(t.myLastDowningFill,0,0),r("请在棋盘内落子");var p="[".concat(m,",").concat(y,"]");if(-1!==h.indexOf(p)||-1!==u.indexOf(p))return t.context.drawImage(t.myLastDowningFill,0,0),r("不能重复位置落子");f=!1,t.downingPiece(o,a-s,!0),h.push(p),console.log("自己棋子位置：",h);var g=function(t){var e,n,i=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){o=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}return n}}(e,n)||function(t,e){if(t){if("string"==typeof t)return v(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=i[0],r=i[1],a=0,s=0,c=0,l=0,d=4,u=9,f=0,m=Math.max(o,r),y=Math.min(o,r);for(m<4&&(u-=d-m,d=m),y>12&&(u-=y-12);f<u;){var p=o+f-d,g=r+f-d,w=r+(u-1-f)-d,E="[".concat(p,",").concat(r,"]"),b="[".concat(o,",").concat(g,"]"),C="[".concat(p,",").concat(g,"]"),L="[".concat(p,",").concat(w,"]");if(-1!==h.indexOf(E)?a++:a=0,5==a)return"横向五连";if(-1!==h.indexOf(b)?s++:s=0,5==s)return"竖向五连";if(-1!==h.indexOf(C)?c++:c=0,5==c)return"向下斜向五连";if(-1!==h.indexOf(L)?l++:l=0,5==l)return"向上斜向五连";f++}return"没有五连"}([m,y]);if(e.emit(b.PIECE_DOWN,{roomName:l,position:[m,y]}),"没有五连"!=g)return playend(d.my);countDownRestart()}}),!1)}},{key:"setLastFill",value:function(){var t=document.createElement("canvas"),e=t.getContext("2d");return e.width=e.height=t.width=t.height=this.canvas.width,e.drawImage(this.canvas,0,0),t}},{key:"drawLine",value:function(t,e,n,i){this.context.moveTo(t,e),this.context.lineTo(n,i),this.context.lineWidth=1,this.context.strokeStyle=b.LINE_COLOR,this.context.stroke()}},{key:"drawCircular",value:function(t,e,n,i){this.context.lineWidth=0,this.context.beginPath(),this.context.arc(t,e,n,0,2*Math.PI),this.context.stroke(),this.context.fillStyle=i||"black",this.context.fill()}},{key:"downPiece",value:function(t,e,n,i){this.drawCircular(this.spacing*t,this.spacing*e,this.pieceSize,n||"black"),this.drawCircular(this.spacing*t,this.spacing*e,this.pieceSize/8,"red"),i&&(this.clearLastPoint||(this.lastPosition=this.relastPosition),this.relastPosition=this.lastPosition,this.drawCircular(this.lastPosition[0]*this.spacing,this.lastPosition[1]*this.spacing,this.pieceSize,b.PVPMap.otherColor(n)),this.lastPosition=[t,e],this.clearLastPoint=!0)}},{key:"downingPiece",value:function(t,e,n){var i=C(t,e,this.spacing),o=i.X,r=i.Y;this.reLastDraw("my"),this.downPiece(o,r,d.my,n),this.otherLastDowningFill=this.setLastFill()}},{key:"reLastDraw",value:function(t,e){e&&(this.clearLastPoint=!1),this.context.drawImage(this[t+"LastDowningFill"],0,0)}},{key:"reLoadGame",value:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.width),this.init()}}])&&E(n.prototype,i),t}();var x=n(586);window.onload=function(){inputBtn.addEventListener("click",(function(t){inputUserName.value?(m=inputUserName.value,localStorage.setItem("userName",m),a(inputInfo,"style.display","none"),P()):r("用户名不能为空")})),readyBtn.addEventListener("click",k),reStartBtn.addEventListener("click",O),gamesLobby.addEventListener("click",(function(t){var n=s(t.target,"room-item");n&&(l=n.id,console.log("加入房间，房间名：",l),e.emit(x.PLAYER_JOIN,{userName:m,roomName:l,userId:y}))})),reChessConfirm.addEventListener("click",(function(t){var n=s(t.target,"btn ok"),i=s(t.target,"btn no");(n||i)&&(e.emit(x.PIECE_RECHESS,{roomName:l,userId:y,apply:!1,feedback:n&&!0}),n&&c.reLastDraw("other",!0),a(reChessConfirm,"style.display","none"))})),goBack.addEventListener("click",(function(t){e.emit(x.PLAYER_LEAVE,{userName:m,roomName:l,userId:y}),a([game,readyConfirm,readyConfirm,gamesLobby],["style.display","style.display","style.display","style.display"],["none","none","none","block"])})),m||a(inputInfo,"style.display","flex")},e.on(x.CONNECT,(function(){console.log("socket连接成功"),e.on(x.ROOMS_INFO,(function(t){console.log("游戏大厅房间：",t),N(t)})),e.on(x.MESSAGE,(function(t){console.log("服务端提示：",t),1==t.code&&(r(t.data),"对手已逃走"==t.data&&(S(),a(reStartConfirm,"style.display","flex"))),0==t.code&&"可以进入"==t.data&&(a([game,gamesLobby],["style.display","style.display"],["block","none"]),P())}))}));var N=function(t){for(var e in t){var i=t[e],o=Object.keys(i),r=o.length&&i[o[0]],s=2==o.length&&i[o[1]],c='<div class="room-item" id="'.concat(e,'">\n            <div class="room-item-avatar left-avatar ').concat(r||"filter",'">\n                <img src="').concat(n(321),'" alt="" width="100%">\n                <div class="room-item-username left-username">').concat(r?r.userName:"待加入",'</div>\n            </div>\n            <div class="room-item-checkerboard ').concat(2==o.length?"":"filter",'">\n                <img src="').concat(n(295),'" alt="" width="100%">\n            </div>\n            <div class="room-item-avatar right-avatar ').concat(s||"filter",'"">\n                <img src="').concat(n(321),'" alt="" width="100%">\n                <div class="room-item-username right-username">').concat(s?s.userName:"待加入","</div>\n            </div>\n        </div>");gamesLobby.innerHTML+=c}N=function(t){for(var e in t){var n=t[e],i=Object.keys(n),o=i.length&&n[i[0]],r=2==i.length&&n[i[1]],s="classList.".concat(o?"remove":"add");if(a([window[e].getElementsByClassName("left-avatar")[0],window[e].getElementsByClassName("left-username")[0]],[s,"innerText"],["filter",o?o.userName:"待加入"]),o){var c="classList.".concat(r?"remove":"add");a([window[e].getElementsByClassName("right-avatar")[0],window[e].getElementsByClassName("right-username")[0],window[e].getElementsByClassName("room-item-checkerboard")[0]],[c,"innerText",c],["filter",r?r.userName:"待加入","filter"])}}}};function P(){c=new L,e.on(x.PLAYER_INFO,(function(t){console.log("玩家信息：",t),d.my=t.pieceColor,d.other="black"==d.my?"white":"black",m=t.userName,t.socketId,y||(y=t.userId,localStorage.setItem("userId",y)),a([window[d.other+"AdminDefeat"],window[d.other+"RegretChess"]],["style.opacity","style.opacity"],["0.5","0.5"]),window[d.my+"AdminDefeat"].addEventListener("click",I.bind(window,d.other)),window[d.my+"RegretChess"].addEventListener("click",(function(){if(f)return r("你还没有落子");e.emit(x.PIECE_RECHESS,{roomName:l,userId:y,apply:!0})})),t.ready||a(readyConfirm,"style.display","flex")})),e.on(x.PLAYER_JOIN,(function(t){console.log("房间信息：",t);var e=["black","white"];for(var n in e)x.PVPMap.otherColor(e[n]),a(window[e[n]+"Username"],"innerText","等待玩家加入");for(var i in t){var o=t[i];a([window[o.pieceColor+"Username"],window[o.pieceColor+"Piece"]],["innerText","style.background"],[o.userName,o.pieceColor])}})),e.on(x.PLAYER_READY,(function(t){console.log("玩家准备情况",t);var e,n=0,i="black";for(var o in t)t[o].ready&&(a(window[t[o].pieceColor+"Ready"],"style.display","block"),n++),t[o].win||(i=t[o].pieceColor);2==n&&(r("开始游戏！".concat(x.PVPMap[i][0],"方先")),a([blackReady,whiteReady,blackCountDown,whiteCountDown],["style.display","style.display","innerText","innerText"],["none","none","60s","60s"]),e=i,d.my==e&&(f=!0))})),e.on(x.PLAYER_END,(function(t){console.log("胜利者：",t),S(),window[t+"WinNum"].innerText++,r("".concat(x.PVPMap[t][0],"方胜，你").concat(x.PVPMap.victoryOrDefeat(t,d.my),"了"),null,(function(){a(reStartConfirm,"style.display","flex")}))})),e.on(x.PIECE_RECHESS,(function(t){var e=t.apply,n=t.feedback;e?a(reChessConfirm,"style.display","flex"):n?(c.reLastDraw("my",!0),f=!0,h.pop()):r("对方拒绝")}))}function k(){a(readyConfirm,"style.display","none"),e.emit(x.PLAYER_READY,{roomName:l,userId:y})}function O(){a(reStartConfirm,"style.display","none"),c.reLoadGame(),h=[],k()}function I(t){e.emit(x.PLAYER_END,{roomName:l,winner:t})}function S(){clearTimeout(null),a([blackCountDown,whiteCountDown,blackAvatar,whiteAvatar],["innerText","innerText","classList.remove","classList.remove"],["60s","60s","active","active"])}})()})();